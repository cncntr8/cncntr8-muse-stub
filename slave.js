var osc = require('node-osc');
var Repeat = require('repeat');

var index = 0;
var sine = [
  0.5,
  0.5499167083234141,
  0.5993346653975307,
  0.6477601033306698,
  0.6947091711543253,
  0.7397127693021015,
  0.7823212366975177,
  0.8221088436188455,
  0.8586780454497613,
  0.8916634548137417,
  0.9207354924039483,
  0.9456036800307177,
  0.9660195429836131,
  0.9817790927085965,
  0.9927248649942302,
  0.9987474933020273,
  0.9997868015207525,
  0.9958324052262343,
  0.9869238154390976,
  0.9731500438437073,
  0.9546487134128409,
  0.9316046833244369,
  0.904248201909795,
  0.87285260608836,
  0.8377315902755753,
  0.7992360720519782,
  0.7577506859107321,
  0.7136899401169149,
  0.6674940750779523,
  0.619624664606991,
  0.5705600040299336,
  0.5207903312166452,
  0.47081292828620996,
  0.42112715292837566,
  0.37222944898658417,
  0.32460838615519005,
  0.2787397783525738,
  0.2350819295457533,
  0.19407105452864037,
  0.15611692040801295,
  0.1215987523460359,
  9.08614444677946e-2,
  6.42121137932059e-2,
  4.191703162527255e-2,
  2.4198963055241995e-2,
  1.1234941167451495e-2,
  3.15449818326774e-3,
  3.837121794958431e-5,
  1.9176955820797148e-3,
  8.773693687833761e-3,
  2.0537862668430773e-2,
  3.709265883613394e-2,
  5.827267213992343e-2,
  8.38662788880496e-2,
  0.11361775622200643,
  0.14722983721480404,
  0.18436668106383958,
  0.2246572287011812,
  0.2676989102931217,
  0.31306166758488196,
  0.36029225090053707,
  0.4089187478639525,
  0.4584552985912518,
  0.5084069502421753,
  0.5582746024252468,
  0.6075599940439078,
  0.6557706817566893,
  0.7024249603082992,
  0.7470566755693044,
  0.7892198821941001,
  0.8284932993593945,
  0.8644845200629383,
  0.8968339319245766,
  0.9252183103142824,
  0.9493540479058135,
  0.9689999883873694,
  0.9839598360157433,
  0.9940841169385002,
  0.9992716726873025,
  0.999470670919886,
  0.994679123311691,
  0.9849449054225432,
  0.9703652783398863,
  0.9510859168781467,
  0.9272994540441402,
  0.8992435563117451,
  0.8671985489370566,
  0.8314846150410911,
  0.7924585964458808,
  0.7505104282289423,
  0.7060592426208783,
  0.6595491811746761,
  0.6114449570501229,
  0.5622272117535309,
  0.5123877127266789,
  0.46242443976909536,
  0.4128366093885093,
  0.3641196867945279,
  0.31676043537403575,
  0.27123205311233933,
  0.2279894445553151,
  0.18746467555355828,
  0.15006265620322817,
  0.11615709511820876,
  8.608676545717314e-2,
  6.015212001416498e-2,
  3.861228919359633e-2,
  2.1682491864905784e-2,
  9.531884966754223e-3,
  2.2818733468112917e-3,
  4.896724648262296e-6,
  2.7237058980054685e-3,
  1.0411135424341522e-2,
  2.2990375048955514e-2,
  4.0335737167662145e-2,
  6.2273912655785746e-2,
  8.858570251564607e-2,
  0.11900820804048395,
  0.1532374576114388,
  0.19093144388148336,
  0.23171354099978253,
  0.2751762677327001,
  0.3208853588815865,
  0.36838410431709956,
  0.4171979122758453,
  0.4668390513243997,
  0.5168115236105693,
  0.566616020709972,
  0.6157549125507695,
  0.6637372195688465,
  0.7100835184133205,
  0.7543307321861876,
  0.7960367573536122,
  0.8347848810983012,
  0.8701879449762243,
  0.9018922132758105,
  0.9295809074282484,
  0.9529773711542313,
  0.9718478347220524,
  0.9860037506974879,
  0.9953036778474351,
  0.9996546943739588,
  0.9990133263581809,
  0.9933859821373067,
  0.9828288882746388,
  0.9674475277623416,
  0.9473955860702516,
  0.9228734155714666,
  0.8941260336876582,
  0.861440674755988,
  0.8251439200785584,
  0.7855984348299936,
  0.7431993444268991,
  0.6983702865653061,
  0.6515591783728512,
  0.6032337409688983,
  0.5538768261497211,
  0.5039815918929678,
  0.4540465748861592,
  0.4045707093129053,
  0.35604834166746735,
  0.3089642914079954,
  0.2637890068007669,
  0.22097386435661032,
  0.1809466588260249,
  0.14410732881543847,
  0.11082396073285078,
  8.142911099012662e-2,
  5.6216483209247714e-2,
  3.5437993632815135e-2,
  1.9301254060221595e-2,
  7.967497459178297e-3,
  1.5499669792019555e-3,
  1.1278446349444193e-4,
  3.6703097646836325e-3,
  1.2186997265921207e-2,
  2.5577751040938013e-2,
  4.370877510440774e-2,
  6.639891025720934e-2,
  9.34214441692568e-2,
  0.12450637661416197,
  0.15934311722225003,
  0.19758358879685795,
  0.23884570518663423,
  0.28271718896405323,
  0.32875969076519374,
  0.37651316913168953,
  0.4255004870929006,
  0.4752321795608163,
  0.5252113439034074,
  0.5749386048314762,
  0.6239171039914799,
  0.6716574644099493,
  0.7176826801864467,
  0.7615328825788497,
  0.8027699348598005,
  0.8409818100340678,
  0.8757867076760752,
  0.9068368687535526,
  0.9338220503208345,
  0.9564726253638138,
  0.9745622768239472,
  0.9879102588834882,
  0.9963832029179536,
  0.9998964500713347,
  0.9984148971393996,
  0.9919533473093081,
  0.9805763622510577,
  0.9643976170386201,
  0.9435787643461747,
  0.918327819268028,
  0.8888970809005464,
  0.85558061145299,
  0.8187112980751194,
  0.7786575267588292,
  0.7358195015470981,
  0.6906252458274701,
  0.6435263256638626,
  0.5949933378977189,
  0.5455112080999222,
  0.49557434535479805,
  0.4456817022879601,
  0.39633178969661886,
  0.3480176955944765,
  0.3012221584392819,
  0.2564127437697452,
  0.21403717244521808,
  0.1745188471668752,
  0.13825262197787752,
  0.10560085701229066,
  7.688979791241468e-2,
  5.240631609015911e-2,
  3.239504240272989e-2,
  1.705592288196478e-2,
  6.542220939675325e-3,
  9.589860103018655e-4,
  3.620039316861723e-4,
  4.757239551422043e-3,
  1.4100777128068342e-2,
  2.8299259122722853e-2,
  4.721081899668805e-2,
  7.064649869503525e-2,
  9.837213665302369e-2,
  0.1301107074610533,
  0.1655450898109892,
  0.20432123506743782,
  0.24605170480468896,
  0.29031954196338594,
  0.3366824369476389,
  0.3846771470363039,
  0.4338241249511135,
  0.4836323103345773,
  0.5336040362627392,
  0.5832400017685796,
  0.6320442606922364,
  0.6795291770110842,
  0.7252202971376946,
  0.7686610905032374,
  0.8094175110600197,
  0.8470823341261222,
  0.8812792252398014,
  0.9116665003690407,
  0.9379405399054455,
  0.9598388223310099,
  0.9771425472463491,
  0.9896788215519585,
  0.9973223869389191,
  0.9999968714285103,
  0.9976755524557795,
  0.990381623872576,
  0.9781879642022515,
  0.9612164084615429,
  0.9396365308253614,
  0.9136639502976893,
  0.8835581763177639,
  0.8496200158275489,
  0.8121885677081957,
  0.7716378346161225,
  0.7283729860720964,
  0.682826310141309,
  0.6354528941539346,
  0.586726077622946,
  0.5371327227921789,
  0.48716835006972026,
  0.43733218695178366,
  0.3881221799066018,
  0.340030019057901,
  0.29353622537972834,
  0.2491053494897129,
  0.20718133001284977,
  0.16818305789351623,
  0.13250019097561117,
  0.10048926067019204,
  7.247010961146488e-2,
  4.872269589490652e-2,
  2.9484295828523244e-2,
  1.4947133146407332e-2,
  5.256458372732198e-3,
  5.090975265252817e-4,
  7.524846680927455e-4,
  5.984187953569087e-3,
  1.6151933933097384e-2,
  3.1154129849860046e-2,
  5.0840878721322647e-2,
  7.50154770603369e-2,
  0.10343638027135743,
  0.1358196160842033,
  0.17184162191110613,
  0.21114247777713413,
  0.2533295025216124,
  0.2979811773384675,
  0.3446513574528139,
  0.3928737298520579,
  0.4421664725313815,
  0.4920370686999509
];

module.exports = function(user, dataType) {
  var client = new osc.Client('0.0.0.0', user.port);
  console.log('Stub for ' + user.username + ' started on port ' + user.port);

  Repeat(function() {
    switch (dataType) {
      case 'sine':
        client.send('/muse/elements/experimental/concentration', sine[index]);
        client.send('/muse/elements/experimental/mellow', 1 - sine[index]);
        if (index < sine.length - 1) {
          index++;
        } else {
          index = 0;
        }
        break;
      case 'portLSD':
        client.send('/muse/elements/experimental/concentration', (user.port - 5000) / 10);
        client.send('/muse/elements/experimental/mellow', (10 - (user.port - 5000)) / 10);
        break;
      default:

    }
  }).every(100, 'ms').start.now();
};
